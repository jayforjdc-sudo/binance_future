# 🚨 위험 관리 가이드

## 레버리지 거래의 위험성

### 핵심 개념

**레버리지 거래**는 자신의 자본보다 많은 금액을 거래하는 것입니다.

```
예시: $100 자본, 2배 레버리지
- 실제 거래량: $200
- 2배 수익도 가능하지만, 2배 손실도 가능
```

### 청산(Liquidation) 이해하기

```
청산이란: 보유 포지션이 강제 종료되어 손실이 실현되는 것

발생 조건:
- 마진율(Margin Level)이 일정 수준 이하로 떨어짐
- Binance는 마진율 50% 이하에서 청산 시작
```

**예시 시나리오**:

| 단계 | 상황 | 마진율 | 조치 |
|------|------|--------|------|
| 1 | 거래 시작 | 500% | ✅ 안전 |
| 2 | 손실 -20% | 150% | ⚠️ 주의 |
| 3 | 손실 -30% | 75% | 🔴 위험 |
| 4 | 손실 -45% | 50% | 💥 청산 |

---

## 청산 위험 최소화 전략

### 1. 보수적 레버리지 사용

**권장값**:
```
초기: 1.5~2배
최대: 3~5배 (경험자만)
절대 금지: 10배 이상
```

**이유**:
- 레버리지가 높을수록 청산까지의 거리가 가까움
- 시장 변동성이 높을 때 위험 증가

### 2. 적절한 포지션 크기

**공식**:
```
최대 포지션 가치 = 계좌 × 위험비율 / 레버리지

권장:
- 보수적: 계좌의 5%
- 중간: 계좌의 10~15%
- 공격적: 계좌의 20% (금지!)
```

**예시 (100달러 계좌)**:

```
보수적 전략 (2x 레버리지):
- 포지션 가치: 100 × 5% / 2 = 2.5 USDT
- 손절매 2% 시: 손실 0.05 USDT (계좌의 0.05%)
- 청산까지 거리: 매우 멀음 ✅

공격적 전략 (5x 레버리지):
- 포지션 가치: 100 × 20% / 5 = 4 USDT
- 손절매 2% 시: 손실 0.4 USDT (계좌의 0.4%)
- 청산까지 거리: 가까움 ⚠️
```

### 3. 손절매 설정

**중요**: 손절매는 필수입니다!

```
추천 손절매:
- 보수적: -1.5% ~ -2%
- 중간: -2% ~ -3%
- 공격적: -3% ~ -5% (고수용)

금지: 손절매 없이 거래하기
```

**손절매 없을 때의 위험**:
- 작은 손실이 큰 손실로 변할 수 있음
- 청산으로 인한 강제 청산 위험
- 멘탈 붕괴 후 더 큰 손실 발생

### 4. 이익실현 설정

```
추천 이익실현:
- 보수적: +2% ~ +3%
- 중간: +3% ~ +5%
- 공격적: +5% ~ +10%

원칙: 작은 이익도 모이면 큼
```

### 5. 최대 일일 손실 제한

```
1일 최대 손실:
- 보수적: 계좌의 2%
- 중간: 계좌의 5%
- 공격적: 계좌의 10%

달성 방법:
- 거래 수 제한 (예: 1일 최대 5거래)
- 누적 손실 모니터링
- 손실 달성 시 당일 거래 중단
```

---

## 마진율 모니터링

### 마진율이란?

```
마진율(%) = 사용가능마진 / 사용중인마진 × 100

또는

마진율(%) = (총 자산 - 사용 마진) / 사용 마진 × 100
```

### 마진율 레벨별 대응

| 마진율 | 상태 | 조치 | 청산까지 |
|--------|------|------|---------|
| > 500% | 최상 | - | 매우 안전 |
| 200~500% | 양호 | - | 안전 |
| 100~200% | 주의 | 모니터링 | 주의 필요 |
| 50~100% | 위험 | 포지션 축소 | 가까움 |
| < 50% | 심각 | 즉시 청산 | 임박 |

### 실시간 모니터링 코드

```python
def check_margin_level():
    account = bot.get_account_info()
    margin_level = account['margin_level']
    
    if margin_level < 50:
        # 즉시 청산
        logger.critical("🚨 청산 위험! 모든 포지션 종료")
        close_all_positions()
    
    elif margin_level < 100:
        # 포지션 축소
        logger.warning(f"⚠️ 마진율 {margin_level:.1f}% - 위험!")
        reduce_positions_by_50_percent()
    
    elif margin_level < 200:
        # 경고만
        logger.info(f"📊 마진율 {margin_level:.1f}% - 주의 필요")
```

---

## 실전 위험 관리 시나리오

### 시나리오 1: 정상 거래 (Best Case)

```
초기 자본: $100
포지션: BTC 2배 레버리지

설정값:
- 포지션 크기: $7.5 (계좌의 7.5%)
- 손절매: -2%
- 익절: +5%

결과 1: 익절 (+5%)
- 수익: $7.5 × 5% = +$0.375
- 새로운 계좌: $100.375
- 마진율: 매우 높음 ✅

결과 2: 손절매 (-2%)
- 손실: $7.5 × 2% = -$0.15
- 새로운 계좌: $99.85
- 마진율: 높음 ✅
```

### 시나리오 2: 급락장 (Worst Case)

```
상황: 시장이 갑자기 5% 급락
초기: BTC 단 숏으로 $7.5 진입

시간 | 손실% | 수익 | 마진율 | 조치
-----|-------|------|--------|------
즉시 | 0% | 0 | 500% | -
30초 | -2% | +$0.15 | 490% | 손절매 자동 체결 ✅
```

### 시나리오 3: 위험한 상황 (경고)

```
상황: 손절매를 넓히고 포지션을 크게 잡음
설정:
- 포지션: 계좌의 30% ($30)
- 손절매: -5%

시간 | 손실% | 손실액 | 마진율 | 상태
-----|-------|---------|--------|------
0h | 0% | 0 | 500% | 정상
1h | -1% | -$0.15 | 498% | 정상
2h | -3% | -$0.90 | 490% | 주의
3h | -4% | -$1.20 | 480% | 경고
4h | -5% | -$1.50 | 470% | 손절매 ❌

문제: 큰 손실로 인한 심리적 충격
```

---

## 자동 안전장치

이 봇에는 다음의 자동 안전장치가 구현되어 있습니다:

### 1. 자동 청산

```python
if margin_level < 50:
    close_position_immediately()
    log_critical_event()
```

### 2. 최대 드로우다운 체크

```python
if max_drawdown > 10%:  # 10% 이상 손실
    reduce_position_size()
    increase_stop_loss()
```

### 3. 중복 포지션 방지

```python
if get_position(symbol) is not None:
    # 이미 포지션 있으면 새 진입 금지
    return
```

### 4. 극도의 변동성 회피

```python
if atr > average_atr * 2:  # 변동성 2배 이상
    skip_trading_this_symbol()
```

---

## 심리 관리

### 거래 중 피해야 할 행동

❌ **금지 사항**:
1. 손실을 만회하려고 2배 거래하기
2. 손절매 취소하기
3. 손절매를 계속 내리기
4. 깊은 생각 없이 거래하기
5. 과신으로 인한 레버리지 증가

### ✅ **권장 사항**:
1. 계획을 세우고 그대로 따르기
2. 작은 손실을 받아들이기
3. 연패하면 거래 일시중단
4. 정기적으로 기록 검토하기
5. 감정이 흔들릴 때 거래 피하기

### 손실받아들이기

```
진리: 몇 번의 손실은 필연적이다
확률: 승률 55% = 45% 손실

심리 전환:
- "손실" → "수업료"
- 작은 손실은 큰 손실을 막는 투자
- 손절매 = 위험 관리의 성공
```

---

## 정기 점검 체크리스트

### 일일 점검 (매일)

- [ ] 마진율 확인
- [ ] 활성 포지션 확인
- [ ] 미결제손익 확인
- [ ] 어제 거래 기록 검토
- [ ] 로그 파일 확인

### 주간 점검 (매주)

- [ ] 총 거래 수 확인
- [ ] 승률 계산
- [ ] 평균 수익/손실 확인
- [ ] 최대 단일 손실 확인
- [ ] 누적 손익 확인

### 월간 점검 (매월)

- [ ] 전체 수익률 계산
- [ ] 백테스팅 결과와 비교
- [ ] 신호 정확도 분석
- [ ] 거래 규칙 재검토
- [ ] 개선사항 기록

---

## 비상 상황 대응

### 시장 큰 폭 하락

```
행동 순서:
1. 진정하기 (숨을 깊게)
2. 마진율 확인
3. 청산 위험이 높으면 포지션 축소
4. 새로운 거래 중단
5. 상황 로깅
```

### API 연결 끊김

```
예방:
- 자동 재연결 코드 구현
- 알림 설정

대응:
- 수동으로 포지션 확인
- 필요시 수동 청산
```

### 예상치 못한 큰 손실

```
즉시 조치:
1. 남은 포지션 전부 청산
2. 거래 완전 중단
3. 원인 분석
4. 로그 백업
5. 2주 휴식
```

---

## 장기 생존 전략

### 1단계: 검증 (1개월)

```
목표: 안정성 입증
- 최소 10거래 이상
- 승률 50% 이상
- 누적 손실 < 5%
- 청산 위험 0회
```

### 2단계: 신뢰 구축 (3개월)

```
목표: 일관성 입증
- 월간 수익성
- 충분한 샘플 크기
- 극단 상황 경험
```

### 3단계: 확장 (6개월+)

```
목표: 지속 가능한 성장
- 자본금 10배 이상 증가 가능
- 여러 코인 거래
- 복잡한 전략 도입
```

---

## 최종 체크리스트

거래하기 전에 반드시 확인하세요:

- [ ] API 키가 안전하게 보관되었는가?
- [ ] 레버리지는 2~3배인가?
- [ ] 포지션 크기는 계좌의 15% 이하인가?
- [ ] 손절매가 설정되었는가?
- [ ] 백테스팅을 통해 검증했는가?
- [ ] 테스트 모드로 먼저 실행했는가?
- [ ] 2주간 모니터링했는가?
- [ ] 마진율을 정기적으로 확인할 것인가?
- [ ] 감정적으로 판단하지 않을 것인가?
- [ ] 손실을 수용할 준비가 되었는가?

모든 항목에 체크가 되면 거래를 시작하세요!

---

## 추가 자료

- [Binance 레버리지 거래 가이드](https://www.binance.com/en/futures/BTCUSDT)
- [위험 관리 도서 추천](https://www.amazon.com/Reminiscences-Stock-Operator-Edwin-Leffevre/dp/0471770884)
- [기술적 분석 학습](https://www.investopedia.com/terms/t/technical-analysis.asp)

---

**기억하세요: 작은 거래가 모여 큰 수익을 만듭니다!** 🚀
